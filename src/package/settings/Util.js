Ext.define('Mfw.settings.Util', {
    alternateClassName: 'Util',
    singleton: true,

    api: window.location.origin + '/api',
    // api: 'http://192.168.101.233/api',


    /**
     * Called recursively to transform/sanitize data sent back to server
     * by removing/cleaning up extra fields generated by the UI
     */
    sanitize: function (data) {
        Ext.Object.each(data, function (key, value) {
            if (Ext.String.startsWith(key, '_') || key === 'id' || key === 'output' || key === 'mfw.model.table.Table') {
                delete data[key];
            }

            // remove null or empty string keys
            if (value === '' || value === null) {
                delete data[key];
            }

            if (Ext.isArray(value)) {
                Ext.Array.each(value, function (v) {
                    Util.sanitize(v);
                });
            }
            if (Ext.isObject(value)) {
                Util.sanitize(value);
            }
        });
        // console.log(data);
        return data;
    },

    ruleOperators: [
        { value: '==', text: 'Equals'.t(), sign: ' [ = ]' },
        { value: '!=', text: 'Not Equals'.t(), sign: ' [ &ne; ]' },
        { value: '>', text: 'Greater Than'.t(), sign: ' [ &gt; ]' },
        { value: '<', text: 'Less Than'.t(), sign: ' [ &lt; ]' },
        { value: '>=', text: 'Greater Than or Equal'.t(), sign:' [ &ge; ]' },
        { value: '<=', text: 'Less Than or Equal'.t(), sign: ' [ &le; ]' }
    ],

    conditions: [{
        type:'IP_PROTOCOL',
        name: 'IP Protocol'.t(),
        operators: ['==', '!='],
        field: {
            xtype: 'selectfield',
            forceSelection: true,
            editable: false,
            displayTpl: '{text} [ {value} ]',
            itemTpl: '{text} <span style="color: #999">[ {value} ]</span>',
            // value: 6, // a default value
            options: Globals.protocols
        }
    }, {
        type:'SOURCE_INTERFACE_NAME',
        name: 'Source Interface Name'.t(),
        operators: ['==', '!=']
    }, {
        type:'DESTINATION_INTERFACE_NAME',
        name: 'Destination Interface Name'.t(),
        operators: ['==', '!=']
    }, {
        type:'SOURCE_ADDRESS',
        name: 'Source Address'.t(),
        field: {
            xtype: 'textfield',
            validators: ['ipaddress']
        }
    }, {
        type:'SOURCE_ADDRESS_V6',
        name: 'Source Address IPv6'.t(),
        operators: ['==', '!='],
        field: {
            xtype: 'textfield',
            validators: ['ipaddress']
        }
    }, {
        type:'DESTINATION_ADDRESS',
        name: 'Destination Address'.t(),
        field: {
            xtype: 'textfield',
            validators: ['ipaddress']
        }
    }, {
        type:'DESTINATION_ADDRESS_V6',
        name: 'Destination Address IPv6'.t(),
        operators: ['==', '!='],
        field: {
            xtype: 'textfield',
            validators: ['ipaddress']
        }
    }, {
        type:'SOURCE_ADDRESS_TYPE',
        name: 'Source Address Type'.t(),
        operators: ['==', '!='],
        field: {
            xtype: 'selectfield',
            forceSelection: true,
            editable: false,
            displayTpl: '{text} [ {value} ]',
            itemTpl: '{text} <span style="color: #999">[ {value} ]</span>',
            options: [
                { text: 'Unspecified', value: 'unspec' },
                { text: 'Unicast', value: 'unicast' },
                { text: 'Local', value: 'local' },
                { text: 'Broadcast', value: 'broadcast' },
                { text: 'Anycast', value: 'anycast' },
                { text: 'Multicast', value: 'multicast' },
                { text: 'Blackhole', value: 'blackhole' },
                { text: 'Unreachable', value: 'unreachable' },
                { text: 'Prohibit', value: 'prohibit' }
            ]
        }
    }, {
        type:'DESTINATION_ADDRESS_TYPE',
        name: 'Destination Address Type'.t(),
        operators: ['==', '!='],
        field: {
            xtype: 'selectfield',
            forceSelection: true,
            editable: false,
            displayTpl: '{text} [ {value} ]',
            itemTpl: '{text} <span style="color: #999">[ {value} ]</span>',
            options: [
                { text: 'Unspecified', value: 'unspec' },
                { text: 'Unicast', value: 'unicast' },
                { text: 'Local', value: 'local' },
                { text: 'Broadcast', value: 'broadcast' },
                { text: 'Anycast', value: 'anycast' },
                { text: 'Multicast', value: 'multicast' },
                { text: 'Blackhole', value: 'blackhole' },
                { text: 'Unreachable', value: 'unreachable' },
                { text: 'Prohibit', value: 'prohibit' }
            ]
        }
    }, {
        type:'SOURCE_PORT',
        name: 'Source Port'.t(),
        operators: ['==', '!='],
        field: {
            xtype: 'numberfield',
        }
    }, {
        type:'DESTINATION_PORT',
        name: 'Destination Port'.t(),
        operators: ['==', '!='],
        field: {
            xtype: 'numberfield',
            validators: ['number']
        }
    }, {
        type:'SOURCE_INTERFACE_ZONE',
        name: 'Source Interface Zone'.t(),
        operators: ['==', '!=']
    }, {
        type:'DESTINATION_INTERFACE_ZONE',
        name: 'Destination Interface Zone'.t(),
        operators: ['==', '!=']
    }, {
        type:'CLIENT_INTERFACE_ZONE',
        name: 'Client Interface Zone'.t(),
        operators: ['==', '!=']
    }, {
        type:'SERVER_INTERFACE_ZONE',
        name: 'Server Interface Zone'.t(),
        operators: ['==', '!=']
    }, {
        type:'CLIENT_PORT',
        name: 'Client Port'.t(),
        operators: ['==', '!='],
        field: {
            xtype: 'numberfield',
            validators: ['number']
        }
    }, {
        type:'SERVER_PORT',
        name: 'Server Port'.t(),
        operators: ['==', '!='],
        field: {
            xtype: 'numberfield',
            validators: ['number']
        }
    }, {
        type:'LOCAL_PORT',
        name: 'Local Port'.t(),
        operators: ['==', '!='],
        field: {
            xtype: 'numberfield',
            validators: ['number']
        }
    }, {
        type:'REMOTE_PORT',
        name: 'Remote Port'.t(),
        operators: ['==', '!='],
        field: {
            xtype: 'numberfield',
            validators: ['number']
        }
    }, {
        type:'CLIENT_ADDRESS',
        name: 'Client Address'.t(),
        operators: ['==', '!='],
        field: {
            xtype: 'textfield',
            validators: ['ipaddress']
        }
    }, {
        type:'CLIENT_ADDRESS_V6',
        name: 'Client Address IPv6'.t(),
        operators: ['==', '!='],
        field: {
            xtype: 'textfield',
            validators: ['ipaddress']
        }
    }, {
        type:'SERVER_ADDRESS',
        name: 'Server Address'.t(),
        operators: ['==', '!='],
        field: {
            xtype: 'textfield',
            validators: ['ipaddress']
        }
    }, {
        type:'SERVER_ADDRESS_V6',
        name: 'Server Address IPv6'.t(),
        operators: ['==', '!='],
        field: {
            xtype: 'textfield',
            validators: ['ipaddress']
        }
    }, {
        type:'LOCAL_ADDRESS',
        name: 'Local Address'.t(),
        operators: ['==', '!='],
        field: {
            xtype: 'textfield',
            validators: ['ipaddress']
        }
    }, {
        type:'LOCAL_ADDRESS_V6',
        name: 'Local Address IPv6'.t(),
        operators: ['==', '!='],
        field: {
            xtype: 'textfield',
            validators: ['ipaddress']
        }
    }, {
        type:'REMOTE_ADDRESS',
        name: 'Remote Address'.t(),
        operators: ['==', '!='],
        field: {
            xtype: 'textfield',
            validators: ['ipaddress']
        }
    }, {
        type:'REMOTE_ADDRESS_V6',
        name: 'Remote Address IPv6'.t(),
        operators: ['==', '!='],
        field: {
            xtype: 'textfield',
            validators: ['ipaddress']
        }
    }, {
        type:'CLIENT_HOSTNAME',
        name: 'Client Hostname'.t(),
        operators: ['==', '!=']
    }, {
        type:'SERVER_HOSTNAME',
        name: 'Server Hostname'.t(),
        operators: ['==', '!=']
    }, {
        type:'LOCAL_HOSTNAME',
        name: 'Local Hostname'.t(),
        operators: ['==', '!=']
    }, {
        type:'REMOTE_HOSTNAME',
        name: 'Remote Hostname'.t(),
        operators: ['==', '!=']
    }, {
        type:'CLIENT_USERNAME',
        name: 'Client Username'.t(),
        operators: ['==', '!=']
    }, {
        type:'SERVER_USERNAME',
        name: 'Server Username'.t(),
        operators: ['==', '!=']
    }, {
        type:'LOCAL_USERNAME',
        name: 'Local Username'.t(),
        operators: ['==', '!=']
    }, {
        type:'REMOTE_USERNAME',
        name: 'Remote Username'.t(),
        operators: ['==', '!=']
    }, {
        type: 'CT_STATE',
        name: 'Connection State',
        operators: ['==', '!='],
        field: {
            xtype: 'selectfield',
            forceSelection: true,
            editable: false,
            options: [
                { text: 'Established', value: 'established' },
                { text: 'Related', value: 'related' },
                { text: 'Invalid', value: 'invalid' }
            ]
        }
    }],

    // adds timezone computation to ensure dates showing in UI are showing actual server date
    serverToClientDate: function (serverDate) {
        if (!serverDate) { return null; }
        return Ext.Date.add(serverDate, Ext.Date.MINUTE, new Date().getTimezoneOffset() / 60000);
    },

    // extracts the timezone computation from UI dates before requesting new data from server
    clientToServerDate: function (clientDate) {
        if (!clientDate) { return null; }
        return Ext.Date.subtract(clientDate, Ext.Date.MINUTE, new Date().getTimezoneOffset() / 60000);
    },

    constructor: function() {
        this.initConfig({
            ruleOperatorsMap: Ext.Array.toValueMap(this.ruleOperators, 'value'),
            ruleConditionsMap: Ext.Array.toValueMap(this.conditions, 'type')
        });
    }
});
